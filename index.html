<!DOCTYPE html>
<html>
<!--Hello-->

<head>
    <!--From https://www.favicon.cc/?action=icon&file_id=619494-->
    <link href="/static/favicon/favicon.ico" rel="icon" type="image/x-icon">
    <!-- Bowser: browser detection -->
    <script src="/node_modules/bowser/bundled.js" type="text/javascript"></script>
    <!-- webix -->
    <script src="/node_modules/webix/webix.js" type="text/javascript" charset="utf-8"></script>
    <link href="/node_modules/webix/webix.css" rel="stylesheet" type="text/css" charset="utf-8">
    <!-- papaya -->
    <script src="/src/papaya.js" type="text/javascript" charset="utf-8"></script>
    <link href="/css/papaya.css" rel="stylesheet" type="text/css" charset="utf-8" />
    <!-- webixPapaya Object  -->
    <script src="/src/webixPapayaObject.js" type="text/javascript"></script>
    <!-- sample data -->
    <script src="/src/imageList.js" type="text/javascript"></script>
    <!-- functions -->
    <script src="/src/setImageParams.js" type="text/javascript"></script>
    <!-- webix Layout and Viewer Controls -->
    <script src="/src/webixLayout.js" type="text/javascript"></script>
    <!-- get Girder Images through API -->
    <script src="/src/girderAPI.js" type="text/javascript"></script>
    <!--  -->
    <script src="/node_modules/jszip/dist/jszip.js" type="text/javascript"></script>
    <script src="/node_modules/jszip-utils/dist/jszip-utils.js" type="text/javascript"></script>
    <script type="text/javascript" src="node_modules/requirejs/require.js"></script>
    <script>
        requirejs.onResourceLoad = function (context, map, depArray) {
            //  console.log(map.id, "loaded");
        }
    </script>
    <title>webix Papaya FG</title>
</head>

<body>
    <script>
        console.log("Start");

        /*         { // Girder API Block
                    set_girderUrl('http://candygram.neurology.emory.edu:8080');
                    set_collectionId("5c48db6de62914004de6350f");
                    set_folderId('5c49e88de62914004ded6b45');

                    // placeholder will update once promise is fullfilled; until then, it remains a pleasent greeting.
                    var placeholder = 'hello';
                    var fetch_response = get_collection_ID(collection_name = 'FG').then(function (x) {
                        set_collectionId(x);
                        placeholder = x;
                    });

                    var fetch_response = create_folder(folder_name = 'testing', collection_id = get_collectionId()).then(
                        function (x) {
                            set_folderId(x);
                            placeholder = x;
                        });
                } // END Girder API Block */

        // Papaya Viewer Parameters: Dictionary
        // Used in webixPapaya $init function
        var params = []; // List of image full-paths
        params["images"] = imageList; // From file "imageList.js"
        params["expandable"] = true;
        params["showControls"] = false;
        params["showControlBar"] = false;
        params["showImageButtons"] = false;

        var myAwesomeZipFile;


        // Run
        webix.ready(function () {
            console.log("webix.ready");
            setImageParams(params);
            layout = setupPanels(params);
            webix.ui(layout);
            papaya.Container.startPapaya();

            { // DCM Block
                myFileUrl =
                    "http://candygram.neurology.emory.edu:8080/api/v1/file/5c4b430ce62914004df6ff72/download"
                myZipData = new JSZip.external.Promise(function (resolve, reject) {
                    JSZipUtils.getBinaryContent(myFileUrl, function (err, data) {
                        if (err) {
                            reject(err);
                        } else {
                            resolve(data);
                        }
                    });
                }).then(function (data) {
                    return JSZip.loadAsync(data);
                }).then(function (zData) {
                    myAwesomeZipFile = zData;
                    //add any stuff that should happen once the zData exists..
                    myAwesomeZipFile.folder("13-AX T1 POST-19694").forEach(function (relativePath, file) {
                        console.log("iterating over", relativePath);
                        console.log(file);
                    });
                    return zData
                })
            } // END DCM Block
        });

        console.log("End");
    </script>
</body>

</html>