<!DOCTYPE html>
<html>
<!--Hello-->

<head>
    <!--From https://www.favicon.cc/?action=icon&file_id=619494-->
    <link href="/static/favicon/favicon.ico" rel="icon" type="image/x-icon">
    <!-- Bowser: browser detection -->
    <script src="/node_modules/bowser/bundled.js" type="text/javascript"></script>
    <!-- webix -->
    <script src="/node_modules/webix/webix.js" type="text/javascript" charset="utf-8"></script>
    <link href="/node_modules/webix/webix.css" rel="stylesheet" type="text/css" charset="utf-8">
    <!-- papaya -->
    <script src="/src/papaya.js" type="text/javascript" charset="utf-8"></script>
    <link href="/css/papaya.css" rel="stylesheet" type="text/css" charset="utf-8" />
    <!-- webixPapaya Object  -->
    <script src="/src/webixPapayaObject.js" type="text/javascript"></script>
    <!-- sample data -->
    <script src="/src/imageList.js" type="text/javascript"></script>
    <!-- functions -->
    <script src="/src/setImageParams.js" type="text/javascript"></script>
    <!-- webix Layout and Viewer Controls -->
    <script src="/src/webixLayout.js" type="text/javascript"></script>
    <!-- get Girder Images through API -->
    <script src="/src/girderAPI.js" type="text/javascript"></script>
    <!--  -->
    <script src="/node_modules/jszip/dist/jszip.js" type="text/javascript"></script>
    <script src="/node_modules/jszip-utils/dist/jszip-utils.js" type="text/javascript"></script>
    <script type="text/javascript" src="node_modules/requirejs/require.js"></script>
    <script>
        requirejs.onResourceLoad = function (context, map, depArray) {
            console.log(map.id, "loaded");
        }
    </script>
    <title>webix Papaya</title>
</head>

<body>
    <script>
        console.log("Start");

        // Papaya Viewer Parameters: Dictionary
        // Used in webixPapaya $init function
        var params = []; // List of image full-paths

        // Set default girder API vvariables:
        set_girderUrl('http://candygram.neurology.emory.edu:8080');
        set_collectionId("5c48db6de62914004de6350f"); // "FG"
        set_folderId('5c4bb1fee62914004dfc0cb2'); // "niftis_folder"
        set_fileId('5c4bb534e62914004dfc1038'); // "zipped niftis"
        // http://candygram.neurology.emory.edu:8080/api/v1/file/5c4bb213e62914004dfc0cb5/download


        { // Attempt load from girder Block
            download_item(file_id)
                .then(function (z) {
                    params["images"] = [z['files']["50v50_set-0_2019-M01-D19/set-0_tfce_corrp_tstat1.nii.gz"]];
                    var layout = setupPanels(params);

                    webix.ready(function () {
                        console.log("webix.ready");
                        layout = setupPanels(params);
                        webix.ui(layout);
                        papaya.Container.startPapaya();
                    });
                })

            params['set-0_tfce_corrp_tstat1.nii.gz'] = {
                "min": 0,
                "max": 1, // binary mask
                "lut": "Greyscale",
                "alpha": 0.5,
                "visible": 1,
            };


        } // END Block

        //params["images"] = imageList; // From file "imageList.js"
        params["expandable"] = true;
        params["showControls"] = false;
        params["showControlBar"] = false;
        params["showImageButtons"] = false;

        // Commented out for Girder Version
        /*         // Run
                webix.ready(function () {
                    console.log("webix.ready");
                    setImageParams(params);
                    layout = setupPanels(params);
                    webix.ui(layout);
                    papaya.Container.startPapaya();
                }); */

        console.log("End");
    </script>
</body>

</html>